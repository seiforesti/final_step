%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#0066cc',
    'primaryTextColor': '#ffffff',
    'primaryBorderColor': '#004499',
    'lineColor': '#0066cc',
    'secondaryColor': '#3399ff',
    'tertiaryColor': '#009966',
    'background': '#f8f9fa',
    'mainBkg': '#ffffff',
    'secondBkg': '#f0f8ff',
    'tertiaryBkg': '#e6f7ff'
  }
}}%%

sequenceDiagram
    participant User as ðŸ‘¤ User
    participant Frontend as ðŸ–¥ï¸ React Frontend
    participant Gateway as ðŸšª API Gateway
    participant Auth as ðŸ” Auth Service
    participant RBAC as ðŸ‘¥ RBAC Service
    participant DS as ðŸ—„ï¸ Data Source Service
    participant Edge as ðŸŒ Edge Computing
    participant Catalog as ðŸ“š Catalog Service
    participant Classify as ðŸ·ï¸ Classification Service
    participant Rules as ðŸ“‹ Rule Sets Service
    participant Scan as ðŸ” Scan Logic Service
    participant Compliance as âš–ï¸ Compliance Service
    participant AI as ðŸ¤– AI/ML Service
    participant DB as ðŸ’¾ PostgreSQL
    participant Cache as âš¡ Redis Cache
    participant Queue as ðŸ“¨ Kafka Queue
    
    User->>Frontend: ðŸ“± Access Data Source
    Frontend->>Gateway: ðŸ“¡ API Request
    Gateway->>Auth: ðŸ” Authenticate User
    Auth->>RBAC: ðŸ›¡ï¸ Check Permissions
    RBAC-->>Auth: âœ… Permission Granted
    Auth-->>Gateway: âœ… Authentication Success
    Gateway->>DS: ðŸ—„ï¸ Process Request
    
    DS->>Edge: ðŸš€ Deploy Edge Connector
    Edge->>Edge: ðŸ”Œ Connect to Data Source
    Edge->>Edge: ðŸ” Discover Schema
    Edge->>Edge: ðŸ“Š Extract Metadata
    Edge->>Queue: ðŸ“¨ Send Metadata Event
    Queue->>Catalog: ðŸ“¨ Process Event
    Catalog->>Classify: ðŸ·ï¸ Classify Data
    Classify->>AI: ðŸ¤– ML Processing
    AI-->>Classify: âœ… Classification Result
    Classify->>Rules: ðŸ“‹ Apply Rules
    Rules->>Scan: ðŸ” Trigger Scan
    Scan->>Compliance: âš–ï¸ Check Compliance
    Compliance->>RBAC: ðŸ“ Log Activity
    RBAC->>DB: ðŸ’¾ Store Audit Log
    
    Catalog->>DB: ðŸ’¾ Store Asset Info
    Classify->>DB: ðŸ’¾ Store Classification
    Scan->>DB: ðŸ’¾ Store Scan Results
    Compliance->>DB: ðŸ’¾ Store Compliance Status
    
    Catalog->>Cache: âš¡ Cache Results
    Classify->>Cache: âš¡ Cache Results
    Scan->>Cache: âš¡ Cache Results
    
    DB-->>Compliance: ðŸ“Š Return Status
    Compliance-->>Scan: âœ… Compliance Result
    Scan-->>Classify: âœ… Scan Complete
    Classify-->>Catalog: âœ… Classification Complete
    Catalog-->>DS: âœ… Metadata Processed
    DS-->>Gateway: ðŸ“¡ Response
    Gateway-->>Frontend: ðŸ“¡ API Response
    Frontend-->>User: ðŸ–¥ï¸ Display Results
    
    Note over User,Queue: Real-time Data Processing Pipeline
    
    User->>Frontend: ðŸ”„ Request Real-time Updates
    Frontend->>Gateway: ðŸ“¡ WebSocket Connection
    Gateway->>Queue: ðŸ“¨ Subscribe to Events
    Queue->>Frontend: ðŸ“¨ Real-time Updates
    Frontend-->>User: ðŸ”„ Live Data Updates
    
    Note over Edge,AI: Edge Computing Intelligence
    
    Edge->>AI: ðŸ§  Local AI Processing
    AI-->>Edge: âœ… Local Classification
    Edge->>Queue: ðŸ“¨ Send Processed Data
    Queue->>Catalog: ðŸ“¨ Update Catalog
    Catalog->>Cache: âš¡ Update Cache
    Cache-->>Frontend: âš¡ Real-time Cache Update
